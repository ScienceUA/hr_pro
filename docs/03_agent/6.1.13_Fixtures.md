# Fixtures for 6.1.13 Mapping (Search Anchors → SearchCommand)

Все фикстуры ниже являются эталонными для пункта 6.1.13.
Реализация 6.1.13 считается корректной, если для каждого сценария
формируется ровно описанный ниже `SearchCommand`.

Источник справочников и допустимых фильтров:
`app/config/workua_filters_map.json`

---

## Fixture 1 — Первый запуск, базовый поиск

### Given (from 6.1_Fixtures.md)

Raw query:
Ищу Project Manager с опытом IT, удалёнка, английский обязателен.

Chat state:
- last_run_at: отсутствует

Expected Search Anchors (summary):
- role_anchors:
  - query_text: "Project Manager"
- category:
  - slug: it
- language_requirements:
  - language_id: 1
- location: null
- period/sort: defaults (not encoded)

### Expected SearchCommand

query_terms:
- "Project Manager"

filters:
- categories: it
- languages: 1

algorithm_defaults:
- only_title: 1
- include_synonyms: 1

meta:
- only_new: false
- last_run_at: null

post_filters:
  must:
  - role: Project Manager
  - category: "IT, комп'ютери, інтернет"
  - language: "Англійська"
  - remote
  must_not: []

semantic_criteria:
- опыт управления IT-проектами

uncertainties:
- уровень seniority не указан
- зарплата не указана

notes:
- period/sort не кодируются в filters (по правилу 6.1.13)

---

## Fixture 2 — Повторный запуск через 5 дней (only_new)

### Given (from 6.1_Fixtures.md)

Raw query:
То же самое, но смотри только новые резюме.

Chat state:
- last_run_at: 2026-01-01T10:00
- Δdays: 5

Expected Search Anchors (summary):
- role_anchors:
  - query_text: "Project Manager"
- category:
  - slug: it
- language_requirements:
  - language_id: 1
- location: null
- period:
  - url_param: "2" (not encoded; no source-of-truth in map.json)
- sort: defaults (not encoded)

### Expected SearchCommand

query_terms:
- "Project Manager"

filters:
- categories: it
- languages: 1

algorithm_defaults:
- only_title: 1
- include_synonyms: 1

meta:
- only_new: true
- last_run_at: "2026-01-01T10:00"

post_filters:
  must:
  - language: "Англійська"
  - remote
  must_not: []

semantic_criteria:
- релевантность IT-проектов

uncertainties:
- seniority не указан

notes:
- period.url_param="2" не кодируется: отсутствует в workua_filters_map.json как source-of-truth

---

## Fixture 3 — Office/on-site + location

### Given (from 6.1_Fixtures.md)

Raw query:
Нужен офисный бухгалтер в Киеве, не удалёнка.

Chat state:
- last_run_at: отсутствует

Expected Search Anchors (summary):
- role_anchors:
  - query_text: "Бухгалтер"
- location:
  - slug: kyiv
- category: null
- language_requirements: null
- period/sort: defaults (not encoded)

### Expected SearchCommand

query_terms:
- "Бухгалтер"

filters:
- location: kyiv

algorithm_defaults:
- only_title: 1
- include_synonyms: 1

meta:
- only_new: false
- last_run_at: null

post_filters:
  must:
  - role: Бухгалтер
  - on_site
  - location: "Київ"
  must_not:
  - remote

semantic_criteria:
- опыт офисной бухгалтерии

uncertainties:
- уровень seniority не указан
- зарплата не указана

notes:
- category не применена: не указана в запросе
- period/sort не кодируются в filters

---

## Fixture 4 — Исключения (must-not), несколько ролей

### Given (from 6.1_Fixtures.md)

Raw query:
Ищу backend Python разработчика, но не финтех и не банки.

Chat state:
- last_run_at: отсутствует

Expected Search Anchors (summary):
- role_anchors:
  - query_text: "Backend Developer"
  - query_text: "Python Developer"
- category:
  - slug: it
- language_requirements: null
- location: null
- period/sort: defaults (not encoded)

### Expected SearchCommand

query_terms:
- "Backend Developer"
- "Python Developer"

filters:
- categories: it

algorithm_defaults:
- only_title: 1
- include_synonyms: 1

meta:
- only_new: false
- last_run_at: null

post_filters:
  must:
  - skill: Python
  must_not:
  - domain: fintech
  - domain: banking

semantic_criteria:
- архитектурное мышление
- опыт backend-разработки

uncertainties:
- формат работы не указан

notes:
- исключения (fintech/banking) не являются URL-фильтрами Work.ua и остаются в post_filters
