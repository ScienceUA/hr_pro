# HR-Pro: целостное описание системы

## 1. Назначение

HR-Pro — система для автоматизации поиска и анализа резюме на Work.ua под конкретный запрос рекрутера.

Система:
- принимает запрос рекрутера в свободной форме;
- преобразует запрос в структурированную команду на поиск;
- получает резюме из выдачи Work.ua;
- выполняет смысловое сопоставление резюме с требованиями вакансии;
- возвращает рекрутеру:
  - ссылки на резюме на Work.ua,
  - оценку соответствия,
  - краткое объяснение сильных/слабых сторон относительно заданных критериев.

Проект учебный/личный:
- без перепродажи данных;
- без публичной публикации резюме;
- без построения конкурирующей базы резюме.

---

## 2. Ключевые ограничения и принципы

2.1 Ограничения по данным кандидатов
- система не использует ФИО, контакты и иные персональные идентификаторы как данные для анализа или результата;
- результат для пользователя опирается на ссылку на оригинал резюме на Work.ua и краткое заключение.

2.2 Этический режим доступа к источнику
- система работает в «мягком» режиме запросов (throttling), чтобы не перегружать источник;
- система не предназначена для массового выгружания данных и построения постоянного хранилища резюме.

2.3 Принцип разделения ответственности
- транспорт отвечает только за получение HTML;
- парсинг отвечает только за извлечение структурированных данных и классификацию страниц;
- оркестратор отвечает за порядок шагов и сохранение артефактов выполнения;
- агент отвечает за смысл: постановку задачи, формирование команды на поиск и финальный анализ.

---

## 3. Компоненты системы

Система состоит из трёх логических компонентов.

### 3.1 Агент (интерфейс и “мозг” системы)

Роль:
- принять запрос рекрутера в свободной форме;
- уточнить недостающие критерии;
- разделить критерии на:
  - обязательные (то, что можно превратить в параметры поиска),
  - опциональные (soft skills и контекстные маркеры, проверяемые по тексту резюме);
- сформировать структурированную команду парсеру/краулеру;
- получить собранные данные резюме;
- выполнить семантический анализ и ранжирование;
- сформировать итоговый отчёт для рекрутера.

Границы ответственности:
- агент не реализует транспорт, прокси, retry-политики;
- агент не парсит HTML напрямую.

---

### 3.2 Execution / Crawler Service (исполнитель)

Роль:
- выполнить поиск резюме на Work.ua по структурированной команде;
- собрать список ссылок на резюме из поисковой выдачи;
- загрузить и распарсить детальные страницы резюме;
- сохранить результаты выполнения в локальный артефакт (JSON/JSONL) как результат прогона.

Границы ответственности:
- сервис не принимает решений о релевантности кандидатов;
- сервис не выполняет смысловой анализ (это ответственность агента);
- сервис следует контрактам Fetcher и ParsingResult.

---

### 3.3 Конфигурация фильтров Work.ua (словарь маппинга)

Роль:
- единый источник соответствия между человеческими критериями и параметрами Work.ua.

Применение:
- агент использует словарь для перевода требований вакансии в структурированную команду;
- исполнитель использует словарь для построения каноничного поискового URL и параметров.

Границы ответственности:
- изменения структуры Work.ua предполагают корректировку словаря, а не логики агента/исполнителя.

---

## 4. Контракты и границы модулей

4.1 Контракт Fetcher (инвариант)
Fetcher — транспортный контракт, который возвращает HTML как строку.

Инварианты:
- Fetcher возвращает только HTML (строка);
- Fetcher не классифицирует тип страницы;
- Fetcher не принимает доменных решений.

4.2 Контракт результата парсинга (ParsingResult)
Парсинг возвращает контейнер результата, который:
- содержит метаданные (тип страницы, качество результата);
- содержит полезную нагрузку (payload) в структурированном виде;
- гарантирует отсутствие полезной нагрузки для страниц доступа/блокировок (например, CAPTCHA/BAN/LOGIN).

4.3 Контракт классификации страниц (PageType)
Парсер различает типы страниц (минимум):
- SERP (список резюме),
- RESUME (детальная страница),
- LOGIN / CAPTCHA / BAN,
- NOT_FOUND.

---

## 5. Сквозной сценарий работы (без инфраструктурных деталей)

5.1 Формирование команды
- рекрутер вводит запрос в свободной форме;
- агент извлекает критерии и формирует структурированную команду:
  - обязательные критерии → параметры поиска;
  - опциональные критерии → правила анализа текста резюме.

5.2 Поиск и сбор данных
- исполнитель строит поисковый URL (канонизированный);
- получает SERP, извлекает ссылки на резюме;
- для каждой ссылки загружает детальную страницу и извлекает структурированные данные;
- сохраняет результаты выполнения в JSON/JSONL.

5.3 Семантический анализ и результат
- агент анализирует полученные резюме по опциональным критериям;
- формирует оценку соответствия и краткое объяснение;
- возвращает рекрутеру shortlist: ссылки + оценки + комментарии.

---

## 6. Технологические допущения

- основной язык реализации: Python 3.11;
- парсинг: HTML → структурированные DTO (Pydantic);
- транспорт в локальном исполнителе: синхронный fetcher на базе requests;
- асинхронный resilient-транспорт и прокси-оркестрация рассматриваются как отдельные подсистемы, которые не изменяют контракты Fetcher и ParsingResult и не меняют ответственность Service Layer и парсеров.

---

## 7. Итоговая фиксация

HR-Pro — агентно-управляемая система подбора кандидатов, где:
- исполнитель обеспечивает детерминированный сбор данных с Work.ua по структурированной команде;
- агент обеспечивает постановку задачи, управление поиском и семантический анализ;
- контракты Fetcher и ParsingResult являются ключевыми инвариантами архитектуры;
- результат для пользователя — ссылки на источник + оценка и объяснение соответствия.

## Навигация по документации

Этот документ описывает систему целостно и без дублирования деталей реализации. Углублённые решения и протоколы описаны в связанных документах:

- `Development_Plan.md` — единственный источник истины по порядку работ и фиксированным границам пунктов.
- `docs/02_handoff/DECISIONS.md` — зафиксированные решения, которые нельзя менять без явного согласования.
- `docs/02_handoff/STATUS.md` — текущее состояние выполнения (что закрыто, что активно).
- `docs/02_handoff/NEXT_AGENT.md` — инструкция следующему агенту: что делать дальше и какие ограничения соблюдать.

Протоколы реализации (детальные решения по закрытым пунктам):
- (Пункт 3) Resilient HTTP: cloud-ready transport (задел, не runtime Local MVP).
- (Пункт 4) Парсинг HTML и контракты данных.
- (Пункт 5) Локальный оркестратор (Service Layer). Local MVP.

Если возникает расхождение между описанием и решениями/протоколами, приоритет имеют:
1) `docs/02_handoff/DECISIONS.md`, затем  
2) протоколы пунктов, затем  
3) этот документ.