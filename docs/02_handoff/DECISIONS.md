# DECISIONS.md

## 1. Назначение

Этот документ фиксирует обязательные архитектурные и процессные решения проекта HR-Pro.
Решения обязательны для соблюдения всеми последующими агентами.
Изменения допускаются только по явному согласованию.

## 2. Источники истины и приоритеты

1) `docs/00_context/Development_Plan.md` — единственный источник истины по:
- порядку работ,
- нумерации,
- статусам пунктов,
- запретам на перестановку/параллелизацию.

2) Протоколы реализации в `docs/01_protocols/` — источник истины по уже закрытым пунктам.

3) Этот документ — источник истины по инвариантам и границам ответственности.

Если возникает конфликт текстов, приоритет всегда определяется в указанном порядке.

## 3. Единая нотация (инвариант)

Используется ровно одна схема:
- основные пункты: `1`, `2`, `3`, …
- подпункты: `1.1`, `1.2`, …
- при необходимости: `1.1.1`, `1.1.2`

Запрещено вводить параллельную нумерацию (например “Этап 1/2/3/4”).

## 4. Жёстко зафиксированный порядок усложнения

Инвариант порядка:
**Local MVP → Agent Logic → Cloud → Proxy**

Перестановка, пропуск, параллельное выполнение или “частичная реализация будущих пунктов” запрещены.

## 5. Принцип неизменности закрытых пунктов

Любой пункт со статусом “✅ завершено” считается закрытым.
Рефакторинг, изменение архитектуры, скрытое усложнение или “улучшения по пути” запрещены без отдельного решения.

## 6. Инварианты архитектуры по текущим пунктам плана

### 6.1 Инвариант транспорта (пункт 3)

- Фиксирован контракт Fetcher: `get(url) -> str`.
- Fetcher возвращает сырой HTML строкой.
- Fetcher не возвращает DTO/ParsingResult/Parser.
- Fetcher не принимает доменных решений (не классифицирует PageType).

### 6.2 Эталон Local MVP (пункты 4–5)

- Эталонный транспорт Local MVP: **SmartFetcher (sync, requests, без прокси)**.
- Resilient HTTP (httpx/tenacity/ProxyManager/Executor) существует как **подготовительный задел** и **не используется в runtime Local MVP**.
- Парсер — детерминированный исполнитель: извлекает данные и классифицирует страницы, не оценивает кандидатов.
- Service Layer — детерминированный оркестратор: управляет порядком шагов, троттлит запросы, сохраняет артефакт выполнения.

### 6.3 Инвариант роли Агента (пункт 6)

Агент — центральный управляющий слой, который:

1) принимает **сырой** запрос пользователя (естественный язык);
2) извлекает критерии:
   - поисковые (hard requirements, фильтруемые),
   - первичный отсев (must/must-not),
   - критерии семантического анализа (soft skills, контекст, поведенческие маркеры);
3) формирует **структурированную команду** для существующего Local MVP;
4) получает результаты парсинга;
5) выполняет семантический анализ и ранжирование;
6) формирует осмысленный результат (shortlist/отчёт/оценки/объяснения + ссылки на источник).

Инвариант: агент управляет логикой и анализом, но не вмешивается в транспорт/парсинг/оркестрацию сбора данных.

## 7. Запреты до завершения пункта 6

До завершения пункта 6 запрещено:
- начинать пункт 7 (контейнеризация/облако);
- начинать пункт 8 (proxy-aware orchestration);
- менять реализацию пунктов 1–5 (закрытые пункты).

Документ закрыт.