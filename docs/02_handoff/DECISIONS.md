# DECISIONS.md

## 1. Назначение документа

Данный документ фиксирует архитектурные и процессные решения проекта HR-Pro.
Все решения считаются обязательными для соблюдения всеми последующими агентами.
Изменения возможны только по явному согласованию.

---

## 2. Общая стратегия проекта

Проект HR-Pro строится как агентно-управляемая система поиска и анализа резюме
с поэтапным усложнением:

1. Локальный исполняемый MVP (без прокси, без облака).
2. Подключение логики Агента (управление поиском + семантический анализ).
3. Контейнеризация и миграция в облако.
4. Подключение прокси и proxy-aware оркестрации.

Эта последовательность является принципиальной и не подлежит нарушению.

---

## 3. Этап 1 — Local MVP (реализован)

### 3.1. Состав этапа
- Локальный запуск.
- Сбор резюме по структурированной команде.
- Сохранение результатов в JSON / JSONL.

### 3.2. Архитектурные ограничения
- Эталонный транспорт: SmartFetcher (sync, requests).
- Без прокси.
- Без async/httpx в runtime.
- Без облачных сервисов.
- Парсер является детерминированным исполнителем и не содержит логики принятия решений.

### 3.3. Статус
Этап завершён и считается стабильным.
Любые изменения запрещены.

---

## 4. Этап 2 — Логика Агента и AI-анализ (текущий фокус)

### 4.1. Роль Агента (ключевое решение)

Агент является **центральным управляющим слоем системы** и:

- принимает от пользователя **сырую команду** в естественном языке;
- извлекает из неё:
  - поисковые критерии (hard skills, роли, опыт, география и т.д.);
  - критерии первичного отсева (must / must-not);
  - критерии последующего семантического анализа (soft skills, контекст, поведенческие маркеры);
- формирует **структурированную команду парсеру**;
- получает от парсера массив резюме;
- выполняет **семантическое сопоставление резюме с расширенными критериями**;
- формирует осмысленный результат для пользователя (shortlist, отчёт, оценки).

### 4.2. Принципиальная архитектурная позиция

Агент:
- управляет логикой;
- не занимается транспортом;
- не знает о прокси;
- не вмешивается в механику сбора данных.

Парсер:
- не принимает решений;
- не анализирует смысл;
- исполняет команду Агента буквально.

### 4.3. Внутренняя структура этапа

Этап логически состоит из двух фаз, но является **единым этапом**:

1. Фаза до парсинга:
   - интерпретация пользовательского запроса;
   - формирование поисковой команды.
2. Фаза после парсинга:
   - семантический анализ текстов резюме;
   - фильтрация и ранжирование по soft skills и контексту.

Это **не пост-процесс и не финальный шаг**, а агентная оркестрация всего цикла поиска.

---

## 5. Этап 3 — Контейнеризация и миграция в облако

### 5.1. Назначение
Перенос уже работающей агентной системы в облачную среду.

### 5.2. Принципы
- Локальный режим остаётся эталонным.
- Облако не меняет логику агента и парсера.
- Добавляется инфраструктура исполнения (контейнеры, очереди, БД).

---

## 6. Этап 4 — Proxy-aware оркестрация

### 6.1. Назначение
Добавление обхода блокировок и масштабирования за счёт управления пулом IP.

### 6.2. Состав
- ProxyManager (pool, rotation, quarantine).
- Политика смены IP при 403 / ProxyError / ConnectError.
- Раздельные лимиты:
  - на прокси;
  - на URL.

### 6.3. Ограничение
Этот этап запрещено реализовывать до завершения облачного этапа.

---

## 7. Принцип неизменности завершённых этапов

Любой завершённый этап считается закрытым.
Рефакторинг, изменение архитектуры или скрытое усложнение запрещены.